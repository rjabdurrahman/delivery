<div class="overlay-container">
    <div class="overlay">
        <div class="margin-auto chart-box">
            <section class="clearfix">
                <label class="ch-title mian-color w3-large ex-font" style="float: left; margin-top: 8px;">{{title}}s</label>
                <button id="plusBtn" onclick="document.getElementById('id01').style.display='block';$js('paddyRawSubmit').innerHTML = 'Submit';$js('paddyRawCode').focus();"
                    class="w3-xlarge w3-circle w3-white circle-btn" style="float: right;">+</button>
                <!-- <button class="w3-btn w3-xlarge w3-circle w3-white circle-btn"><i class="fa fa-edit"></i></button> -->
                <button ng-show="load" style="margin-left: 12px;" class="w3-xlarge w3-circle w3-white circle-btn PDF_Btn"><i class="fa fa-print"></i></button>
            </section>
            <div class="w3-card-4 table-container">
                <div class="ch-table-content">
                    <div class="w3-responsive">
                        <table class="w3-table-all chart-tables">
                            <thead>
                                <tr class="main-bg-color">
                                    <th>ID</th>
                                    <th>Code</th>
                                    <th>Name</th>
                                    <th>Primary Unit</th>
                                    <th>Primary Quantity</th>
                                    <th>Primary Unit Price</th>
                                    <th>Primary Total Price</th>
                                    <th>stad Unit</th>
                                    <th>Stand Quantity</th>
                                    <th>Stand Unit Price</th>
                                    <th>Standard Total Price</th>
                                    <th ng-if="userInfo.c_9_e">Edit</th>
                                    <th ng-if="userInfo.c_9_d">Delete</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="paddyRaw in comPaddyRaws | orderBy : 'code' track by $index">
                                    <td>{{$index + 1}}</td>
                                    <td>{{paddyRaw.code}}</td>
                                    <td>{{paddyRaw.name}}</td>
                                    <td>{{paddyRaw.priUnit}}</td>
                                    <td>{{comNum(paddyRaw.priQu)}}</td>
                                    <td>{{comNum(paddyRaw.priUnitPri)}}</td>
                                    <td>{{comNum(paddyRaw.priTotalPri)}}</td>
                                    <td>{{paddyRaw.stdUnit}}</td>
                                    <td>{{comNum(paddyRaw.stdQu)}}</td>
                                    <td>{{comNum(paddyRaw.stdUnitPri)}}</td>
                                    <td>{{comNum(paddyRaw.totalPri)}}</td>
                                    <td ng-if="userInfo.c_9_e">
                                        <button id="{{paddyRaw.$id}}e" onclick="editView(this.id)" class="w3-btn w3-blue">Edit</button>
                                    </td>
                                    <td ng-if="userInfo.c_9_d">
                                        <button id="{{paddyRaw.code}}" onclick="getDbId(event)" class="w3-btn w3-red">Delete</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <div ng-show="!load" class="w3-pale-blue" style="padding: 12px; text-align: center;"><img src="img/loader.gif"
                                alt="Loading..." style="height: 25px; width: 25px;"></div>
                        <div id="nodata" ng-show="nodata" class="w3-pale-blue" style="padding: 12px; text-align: center;">No
                            Data Found!</div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Confirmation diallog start -->
        <div id="confirmDel" class="w3-modal">
            <div class="w3-modal-content div-box w3-animate-zoom w3-card-4" style="width: 450px;">
                <header class="w3-container main-bg-color div-title">
                    <span onclick="$js('confirmDel').style.display='none'" class="w3-button w3-display-topright">&times;</span>
                    <h2>Confirm Delete?</h2>
                </header>
                <div class="w3-container">
                    <p>Deleting this account will not remove name from journal account name.</p>
                    <p>And no more suggestion is available for this account code until you create new one.</p>
                </div>
                <footer class="w3-container w3-white">
                    <p class="flex" style="justify-content: center;">
                        <button onclick="removeChart('raw_materials', onDel)" class="w3-btn w3-red" style="margin-left: 20px; margin-right: 20px;">Confirm
                            Delete</button>
                        <button onclick="$js('confirmDel').style.display='none'" class="w3-btn main-bg-color" style="margin-left: 20px; margin-right: 20px;">Cancel</button>
                    </p>
                </footer>
            </div>
        </div>
        <!-- Confirmation diallog end -->
        <div id="id01" class="w3-modal">
            <div class="w3-modal-content w3-animate-zoom" style="background-color: transparent;">
                <div class="div-box w3-light-gray w3-card-4 margin-auto">
                    <div class="w3-container main-bg-color div-title">
                        <span onclick="exitModel();clearFields();" class="w3-button w3-display-topright">&times;</span>
                        <h2>{{title}}</h2>
                    </div>
                    <div class="w3-container">
                        <form id="form1">

                            <div class="w3-row w3-section">
                                <div class="w3-col" style="width:180px; padding: 10px;">
                                    <label class="w3-medium">Code</label>
                                </div>
                                <div class="w3-rest">
                                    <input class="w3-input w3-border" type="text" name="" id="paddyRawCode" required>
                                </div>
                            </div>
                            <div class="w3-row w3-section">
                                <div class="w3-col" style="width:180px; padding: 10px;">
                                    <label class="w3-medium">Name</label>
                                </div>
                                <div class="w3-rest">
                                    <input class="w3-input w3-border" type="text" name="" id="paddyRawName" required>
                                </div>
                            </div>
                            <div class="w3-row w3-section">
                                <div class="w3-col" style="width:180px; padding: 10px;">
                                    <label class="w3-medium">Primary Unit</label>
                                </div>
                                <div class="w3-rest">
                                    <input class="w3-input w3-border" type="text" name="" id="priUnit" required>
                                </div>
                            </div>
                            <div class="w3-row w3-section">
                                <div class="w3-col" style="width:180px; padding: 10px;">
                                    <label class="w3-medium">Primary Quantity</label>
                                </div>
                                <div class="w3-rest">
                                    <input class="w3-input w3-border commanum" type="text" name="" id="priQu" required>
                                </div>
                            </div>
                            <div class="w3-row w3-section">
                                <div class="w3-col" style="width:180px; padding: 10px;">
                                    <label class="w3-medium">Primary Unit Price</label>
                                </div>
                                <div class="w3-rest">
                                    <input class="w3-input w3-border commanum" type="text" name="" id="priUnitPri"
                                        required>
                                </div>
                            </div>
                            <div class="w3-row w3-section">
                                <div class="w3-col" style="width:180px; padding: 10px;">
                                    <label class="w3-medium">Primary Total Price</label>
                                </div>
                                <div class="w3-rest">
                                    <input class="w3-input w3-border commanum" type="text" name="" id="priTotalPri"
                                        disabled>
                                </div>
                            </div>
                            <div class="w3-row w3-section">
                                <div class="w3-col" style="width:180px; padding: 10px;">
                                    <label class="w3-medium">Standard Unit</label>
                                </div>
                                <div class="w3-rest">
                                    <input class="w3-input w3-border" type="text" name="" id="stdUnit" required>
                                </div>
                            </div>
                            <div class="w3-row w3-section">
                                <div class="w3-col" style="width:180px; padding: 10px;">
                                    <label class="w3-medium">Standard Quantity</label>
                                </div>
                                <div class="w3-rest">
                                    <input class="w3-input w3-border commanum" type="text" name="" id="stdQu" required>
                                </div>
                            </div>
                            <div class="w3-row w3-section">
                                <div class="w3-col" style="width:180px; padding: 10px;">
                                    <label class="w3-medium">Standard Unit Price</label>
                                </div>
                                <div class="w3-rest">
                                    <input class="w3-input w3-border commanum" type="text" name="" id="stdUnitPri"
                                        required>
                                </div>
                            </div>
                            <div class="w3-row w3-section">
                                <div class="w3-col" style="width:180px; padding: 10px;">
                                    <label class="w3-medium">Standard Total Price</label>
                                </div>
                                <div class="w3-rest">
                                    <input class="w3-input w3-border commanum" type="text" name="" id="totalPri"
                                        disabled>
                                </div>
                            </div>
                            <p class="clearfix">
                                <button id="paddyRawSubmit" class="w3-btn main-bg-color" style="float: right;">Submit</button>
                            </p>
                        </form>

                    </div>
                </div>
            </div>
        </div>
        <!-- End of the Journy -->
    </div>
</div>
<!-- Pdf print hide table...........start.................. -->
<div style="display: none;">
    <table border="1" cellspacing="0" style="visibility: hidden;" id="PdfTable">
        <thead>
            <tr>
                <td colspan="11" style="text-align: center; height: 50px; font-size: 25px;"><span>RAW MATERIALS</span><img
                        style="width: 50px; height: 50px; float: right;" src="/img/logo3.png"></td>
            </tr>
            <tr class="main-bg-color">
                <th>ID</th>
                <th>Code</th>
                <th>Name</th>
                <th>Primary Unit</th>
                <th>Primary Quantity</th>
                <th>Primary Unit Price</th>
                <th>Primary Total Price</th>
                <th>stad Unit</th>
                <th>Stand Quantity</th>
                <th>Stand Unit Price</th>
                <th>Standard Total Price</th>
            </tr>
        </thead>
        <tbody>
            <tr ng-repeat="paddyRaw in comPaddyRaws | orderBy : 'code' track by $index">
                <td>{{$index + 1}}</td>
                <td>{{paddyRaw.code}}</td>
                <td>{{paddyRaw.name}}</td>
                <td>{{paddyRaw.priUnit}}</td>
                <td>{{comNum(paddyRaw.priQu)}}</td>
                <td>{{comNum(paddyRaw.priUnitPri)}}</td>
                <td>{{comNum(paddyRaw.priTotalPri)}}</td>
                <td>{{paddyRaw.stdUnit}}</td>
                <td>{{comNum(paddyRaw.stdQu)}}</td>
                <td>{{comNum(paddyRaw.stdUnitPri)}}</td>
                <td>{{comNum(paddyRaw.totalPri)}}</td>
        </tbody>
    </table>
</div>
<!-- Pdf print hide table...........end.................. -->
<script>
    var dbPaddyRaws = null;
    $(document).keypress(function (event) {
        if (event.shiftKey && event.which == 43) {
            event.preventDefault();
            $('#plusBtn').click();
        }
    });
    $js("form1").addEventListener("submit", function (event) {
        event.preventDefault();
    });
    // Total Cal
    $js('priQu').onkeyup = function (event) {
        let priTP = $js('priUnitPri').value;
        // $print(priTP);
        if (priTP != "") {
            $js('priTotalPri').value = numToComma(parseFloat(commaToNum(event.target.value)) * parseFloat(commaToNum(priTP)));
        }
    }
    $js('priUnitPri').onkeyup = function (event) {
        let priQ = $js('priQu').value;
        // $print(priTP);
        if (priQ != "") {
            $js('priTotalPri').value = numToComma(parseFloat(commaToNum(event.target.value)) * parseFloat(commaToNum(priQ)));
        }
    }
    $js('stdQu').onkeyup = function (event) {
        let stdTP = $js('stdUnitPri').value;
        // $print(priTP);
        if (stdTP != "") {
            $js('totalPri').value = numToComma(parseFloat(commaToNum(event.target.value)) * parseFloat(commaToNum(stdTP)));
        }
    }
    $js('stdUnitPri').onkeyup = function (event) {
        let stdQ = $js('stdQu').value;
        // $print(priTP);
        if (stdQ != "") {
            $js('totalPri').value = numToComma(parseFloat(commaToNum(event.target.value)) * parseFloat(commaToNum(stdQ)));
        }
    }
    // Total Cal End
    $js('paddyRawSubmit').addEventListener('click', function () {
        paddyRawSubmit();
    });

    $('input.commanum').keyup(function (event) {
        if (event.target.value.includes(".")) {
            let str = event.target.value.split('.');
            event.target.value = str[0] + "." + str[1].replace(/\D/g, "");
            return;
        }
        // skip for arrow keys
        if ((event.which >= 37 && event.which <= 40) || event.which == 190) return;

        // format number
        $(this).val(function (index, value) {
            return value
                .replace(/\D/g, "")
                .replace(/\B(?=(\d{3})+(?!\d))/g, ",");
        });
    });
    /// edit data show in field start........................

    var editTriget = 0;
    var dbDataCode = "";
    var dbID = "";

    function editView(ID) {
        $js('paddyRawSubmit').innerHTML = 'Update';
        document.getElementById('id01').style.display = 'block';
        var id = ID.slice(0, -1);
        dbID = ID.slice(0, -1);
        editTriget = 1;
        console.log(id, editTriget);
        getRef('paddyRaw/' + id).on('value', function (snapshot) {
            let dbData = snapshot.val();
            console.log(dbData);

            dbDataCode = dbData.code;   ///   from database code grip to control notification...............

            $js('paddyRawCode').value = dbData.code;
            $js('paddyRawName').value = dbData.name;
            $js('priUnit').value = dbData.priUnit;
            $js('priUnitPri').value = numToComma(dbData.priUnitPri);
            $js('priQu').value = numToComma(dbData.priQu);
            $js('priTotalPri').value = numToComma(dbData.priTotalPri);
            $js('stdUnit').value = dbData.stdUnit;
            $js('stdUnitPri').value = numToComma(dbData.stdUnitPri);
            $js('stdQu').value = numToComma(dbData.stdQu);
            $js('totalPri').value = numToComma(dbData.totalPri);
        });
    }

    /// edit data show in field end........................
    function paddyRawSubmit() {
        var paddyRawCode = $js('paddyRawCode').value;
        var paddyRawName = $js('paddyRawName').value;
        var priUnit = $js('priUnit').value;
        var priUnitPri = $js('priUnitPri').value;
        var priTotalPri = $js('priTotalPri').value;
        var priQu = $js('priQu').value;
        var stdUnit = $js('stdUnit').value;
        var stdUnitPri = $js('stdUnitPri').value;
        var stdQu = $js('stdQu').value;
        var totalPri = $js('totalPri').value;
        if (paddyRawCode == "") {
            $('#notification').html("<h6>Code Empty</h6>").removeClass('w3-green').addClass('w3-red').fadeIn(200).delay(1000).fadeOut(200);
            return;
        }
        else if (paddyRawName == "") {
            $('#notification').html("<h6>Name Empty</h6>").removeClass('w3-green').addClass('w3-red').fadeIn(200).delay(1000).fadeOut(200);
            return;
        }
        else if (priUnit == "") {
            $('#notification').html("<h6>Primary Unit Empty</h6>").removeClass('w3-green').addClass('w3-red').fadeIn(200).delay(1000).fadeOut(200);
            return;
        }
        else if (priUnitPri == "") {
            $('#notification').html("<h6>Primary Unit  Price Empty</h6>").removeClass('w3-green').addClass('w3-red').fadeIn(200).delay(1000).fadeOut(200);
            return;
        }
        else if (priQu == "") {
            $('#notification').html("<h6>Primary Quality Empty</h6>").removeClass('w3-green').addClass('w3-red').fadeIn(200).delay(1000).fadeOut(200);
            return;
        }
        else if (priTotalPri == "") {
            $('#notification').html("<h6>Primary Total Price Empty</h6>").removeClass('w3-green').addClass('w3-red').fadeIn(200).delay(1000).fadeOut(200);
            return;
        }
        else if (stdUnit == "") {
            $('#notification').html("<h6>Standard Unit Empty</h6>").removeClass('w3-green').addClass('w3-red').fadeIn(200).delay(1000).fadeOut(200);
            return;
        }
        else if (stdUnitPri == "") {
            $('#notification').html("<h6>Standard Unit  Price Empty</h6>").removeClass('w3-green').addClass('w3-red').fadeIn(200).delay(1000).fadeOut(200);
            return;
        }
        else if (stdQu == "") {
            $('#notification').html("<h6>Standard Quality Empty</h6>").removeClass('w3-green').addClass('w3-red').fadeIn(200).delay(1000).fadeOut(200);
            return;
        }
        else if (totalPri == "") {
            $('#notification').html("<h6>Standard Total Price Empty</h6>").removeClass('w3-green').addClass('w3-red').fadeIn(200).delay(1000).fadeOut(200);
            return;
        }



        var paddyRaw = {
            code: paddyRawCode,
            name: paddyRawName,
            priUnit: priUnit,
            priUnitPri: commaToNum(priUnitPri),
            priQu: commaToNum(priQu),
            priTotalPri: commaToNum(priTotalPri),
            stdUnit: stdUnit,
            stdUnitPri: commaToNum(stdUnitPri),
            stdQu: commaToNum(stdQu),
            totalPri: commaToNum(totalPri),
            actype: 1
        };
        if (editTriget == 1 && dbDataCode == paddyRawCode) {
            editTriget = 0;
            db.child('paddyRaw/' + dbID).update(paddyRaw, function (error) {
                if (error) {
                    $('#notification').html("<h6>Something Went Wrong in Database!</h6>").removeClass('w3-green').addClass('w3-red').fadeIn(200).delay(1000).fadeOut(200);
                } else {
                    $('#notification').html("<h6>Added Sucessfully</h6>").removeClass('w3-red').addClass('w3-green').fadeIn(200).delay(300).fadeOut(200);
                    $js('nodata').style.display = "none";
                    clearFields();

                }
            });
        }
        else if (editTriget == 1 && dbDataCode != paddyRawCode) {

            for (i = 0; i < dbPaddyRaws.length; i++) {
                if (paddyRawCode == dbPaddyRaws[i].code) {
                    $('#notification').html("<h6>Code Already Used in Another Account!</h6>").removeClass('w3-green').addClass('w3-red').fadeIn(200).delay(1000).fadeOut(200);
                    $js('paddyRawCode').focus();
                    return;
                }
            }
            editTriget = 0;
            db.child('paddyRaw/' + dbID).update(paddyRaw, function (error) {
                if (error) {
                    $('#notification').html("<h6>Something Went Wrong in Database!</h6>").removeClass('w3-green').addClass('w3-red').fadeIn(200).delay(1000).fadeOut(200);
                } else {
                    $('#notification').html("<h6>Added Sucessfully</h6>").removeClass('w3-red').addClass('w3-green').fadeIn(200).delay(300).fadeOut(200);
                    $js('nodata').style.display = "none";
                    clearFields();

                }
            });
        } else {
            editTriget = 0;
            if(!insertChart('raw_materials', paddyRaw, clearFields)) return;
        }

        exitModel();
    }

    function clearFields() {
        clearer(paddyRawCode, paddyRawName, priUnit, priQu, priUnitPri, stdUnit, stdQu, stdUnitPri, totalPri, priTotalPri);
    }

    // function printpaddyRaw() {
    //     $print("print");
    //     var ws = XLSX.utils.table_to_sheet(document.getElementById('paddyRawTable'), { cellDates: true });
    //     // var wscols = [
    //     //     { wch: 4 },
    //     //     { wch: 12 },
    //     //     { wch: 20 },
    //     //     { wch: 20 },
    //     //     { wch: 14 },
    //     //     { wch: 40 }
    //     // ];
    //     // var wsrows = [
    //     //     {
    //     //         hpx: 24,
    //     //         level: 2
    //     //     }
    //     // ];
    //     // ws['!cols'] = wscols;
    //     // ws['!rows'] = wsrows;
    //     XLSX.utils.book_append_sheet(wb, ws, 'paddyRaw');
    //     var wbout = XLSX.write(wb, { bookType: 'xlsx', bookSST: true, type: 'binary' });
    //     function s2ab(s) {
    //         var buf = new ArrayBuffer(s.length);
    //         var view = new Uint8Array(buf);
    //         for (var i = 0; i < s.length; i++) view[i] = s.charCodeAt(i) & 0xFF;
    //         return buf;
    //     }
    //     saveAs(new Blob([s2ab(wbout)], { type: "application/octet-stream" }), 'paddyRaw.xlsx');
    // }

    // Delete data start......................
    var onDel = '';
    function getDbId(e) {
        console.log("ok click");
        $js('confirmDel').style.display = 'block';
        onDel = e.target.id;
    }
    // Delete data end......................
    //pdf making and save............................Start....................
    $('.PDF_Btn').click(function () {
        location.reload();
        $js('PdfTable').style.visibility = "visible";
        var printme = document.getElementById('PdfTable');
        var wme = window.open("", "", "width=900,height=900");
        wme.document.write(printme.outerHTML);
        wme.document.close();
        wme.focus();
        wme.print();
        wme.close();
        $js('PdfTable').style.visibility = "hidden";

    })
    //pdf making and save............................End......................
    //Print in Landscape...........start........
    var css = '@page { size: landscape; }',
        head = document.head || document.getElementsByTagName('head')[0],
        style = document.createElement('style');

    style.type = 'text/css';
    style.media = 'print';

    if (style.styleSheet) {
        style.styleSheet.cssText = css;
    } else {
        style.appendChild(document.createTextNode(css));
    }

    head.appendChild(style);
    //Print in Landscape...........end........
</script>